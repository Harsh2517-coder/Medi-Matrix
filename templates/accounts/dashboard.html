{% extends "base.html" %}
{% block content %}

<style>
    /* --- Page Header Styling --- */
    .page-header {
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(30, 64, 175, 0.1);
        animation: fadeIn 0.5s ease-out forwards;
        opacity: 0;
    }
    .page-title {
        font-weight: 800;
        font-size: 2.5rem;
        background: linear-gradient(135deg, var(--hospital-blue) 20%, var(--hospital-teal) 100%);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    
    /* --- General Card & Section Styling --- */
    .content-section {
        margin-bottom: 3rem;
    }
    .section-title {
        font-weight: 700;
        color: var(--deep-navy);
        margin-bottom: 1.5rem;
        opacity: 0;
        animation: fadeIn 0.5s 0.2s ease-out forwards;
    }
    .data-card {
        background: rgba(255, 255, 255, 0.85) !important;
        backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.5);
        border-radius: 1.5rem;
        box-shadow: 0 15px 30px rgba(30, 64, 175, 0.08);
        overflow: hidden;
        opacity: 0;
        transform: translateY(20px);
        animation: slideInUp 0.6s ease-out forwards;
    }
    
    /* --- Table Styling inside Cards --- */
    .table-responsive {
        max-height: 400px; /* Make long tables scrollable */
    }
    .table {
        margin: 0;
        background: transparent;
    }
    .table thead {
        position: sticky;
        top: 0;
        z-index: 1;
    }
    .table thead th {
        background: linear-gradient(135deg, rgba(255,255,255,0.8), rgba(255,255,255,0.6));
        backdrop-filter: blur(10px);
        color: var(--hospital-blue);
        border: none;
        font-weight: 700;
        padding: 1rem;
        text-transform: uppercase;
        font-size: 0.8rem;
        letter-spacing: 0.5px;
    }
    .table tbody tr {
        transition: all 0.2s ease;
    }
    .table tbody tr:hover {
        background: rgba(30, 64, 175, 0.04);
        transform: scale(1.01);
    }
    .table tbody td {
        padding: 1rem;
        border: none;
        vertical-align: middle;
        border-bottom: 1px solid rgba(226, 232, 240, 1);
        font-weight: 500;
        color: var(--deep-navy);
    }
    
    /* Custom Status Badges */
    .status-badge {
        padding: 0.4rem 0.8rem;
        font-weight: 600;
        border-radius: 20px;
        font-size: 0.8rem;
        text-transform: uppercase;
    }
    .status-paid { background-color: rgba(5,150,105,.1); color: var(--hospital-green); }
    .status-pending { background-color: rgba(245,158,11,.1); color: #b45309; }
    .status-overdue { background-color: rgba(153,27,27,.1); color: #991b1b; }
    
    /* Button styles are now standardized in base.html */

    /* --- Form Card Styling --- */
    .form-card {
        padding: 2rem;
        animation-delay: 0.2s; /* Delay animation for form card */
    }
    .form-label {
        color: var(--hospital-blue) !important;
        font-weight: 600 !important;
        font-size: 0.9rem !important;
        margin-bottom: 0.5rem !important;
    }
    .form-control, .form-select {
        background-color: #f8fafc !important;
        border: 1px solid #e2e8f0 !important;
        border-radius: 0.75rem !important;
        padding: 0.8rem !important;
        transition: all 0.3s ease !important;
    }
    .form-control:focus, .form-select:focus {
        border-color: var(--medical-mint) !important;
        box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.15) !important;
    }
    /* Button styles are now standardized in base.html */
    
    /* Animation Keyframes */
    @keyframes fadeIn { to { opacity: 1; } }
    @keyframes slideInUp { to { opacity: 1; transform: translateY(0); } }
</style>

<div class="page-header">
    <h2 class="page-title">Accountant Dashboard</h2>
</div>

<div class="content-section">
    <h3 class="section-title">Patient Invoices & Receipts</h3>
    <div class="data-card">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Invoice #</th>
                        <th>Patient Name</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th class="text-end">Amount (₹)</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for invoice in invoices %}
                    <tr>
                        <td><strong>#{{ invoice.InvoiceID }}</strong></td>
                        <td>{{ invoice.FirstName }} {{ invoice.LastName }}</td>
                        <td>{{ invoice.InvoiceDate.strftime('%d %b, %Y') }}</td>
                        <td><span class="status-badge status-{{ invoice.Status | lower }}">{{ invoice.Status }}</span></td>
                        <td class="text-end">₹ {{ "%.2f"|format(invoice.TotalAmount) }}</td>
                        <td class="text-center">
                            <a href="{{ url_for('accounts.generate_invoice_pdf', invoice_id=invoice.InvoiceID) }}" class="btn action-btn" target="_blank">View PDF</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="6" class="text-center p-4">No invoices found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-7 mb-4 content-section">
        <h3 class="section-title">Hospital Expenses</h3>
        <div class="data-card">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Amount (₹)</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for expense in expenses %}
                        <tr>
                            <td>{{ expense.ExpenseDate.strftime('%d %b, %Y') }}</td>
                            <td>{{ expense.Category }}</td>
                            <td>₹ {{ "%.2f"|format(expense.Amount) }}</td>
                            <td>{{ expense.Description }}</td>
                        </tr>
                        {% else %}
                        <tr><td colspan="4" class="text-center p-4">No expenses recorded yet.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col-lg-5 mb-4 content-section">
        <h3 class="section-title">Add New Expense</h3>
        <div class="data-card form-card">
            <form action="{{ url_for('accounts.add_expense') }}" method="POST">
                <div class="mb-3"><label for="expense_date" class="form-label">Date</label><input type="date" class="form-control" id="expense_date" name="expense_date" required></div>
                <div class="mb-3"><label for="category" class="form-label">Category</label><input type="text" class="form-control" id="category" name="category" placeholder="e.g., Medical Supplies" required></div>
                <div class="mb-3"><label for="amount" class="form-label">Amount (₹)</label><input type="number" step="0.01" class="form-control" id="amount" name="amount" required></div>
                <div class="mb-3"><label for="description" class="form-label">Description</label><textarea class="form-control" id="description" name="description" rows="2"></textarea></div>
                <button type="submit" class="btn submit-btn w-100 mt-2">Add Expense</button>
            </form>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-7 mb-4 content-section">
        <h3 class="section-title">Salary Payments</h3>
        <div class="data-card">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Payment Date</th>
                            <th>Recipient</th>
                            <th>Amount (₹)</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for salary in salaries %}
                        <tr>
                            <td>{{ salary.PaymentDate.strftime('%d %b, %Y') }}</td>
                            <td>{{ salary.Username }} ({{ salary.FirstName }} {{ salary.LastName }})</td>
                            <td>₹ {{ "%.2f"|format(salary.Amount) }}</td>
                            <td>{{ salary.Notes }}</td>
                        </tr>
                        {% else %}
                        <tr><td colspan="4" class="text-center p-4">No salary payments recorded.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col-lg-5 mb-4 content-section">
        <h3 class="section-title">Record Salary Payment</h3>
        <div class="data-card form-card">
            <form action="{{ url_for('accounts.add_salary') }}" method="POST">
                <div class="mb-3"><label for="payment_date" class="form-label">Payment Date</label><input type="date" class="form-control" id="payment_date" name="payment_date" required></div>
                <div class="mb-3"><label for="user_id" class="form-label">Staff Member</label><select class="form-select" id="user_id" name="user_id" required><option selected disabled value="">Choose staff...</option>{% for staff in staff_users %}<option value="{{ staff.UserID }}">{{ staff.Username }}</option>{% endfor %}</select></div>
                <div class="mb-3"><label for="salary_amount" class="form-label">Amount (₹)</label><input type="number" step="0.01" class="form-control" id="salary_amount" name="amount" required></div>
                <div class="mb-3"><label for="notes" class="form-label">Notes</label><input type="text" class="form-control" id="notes" name="notes" placeholder="e.g., Salary for Sept 2025"></div>
                <button type="submit" class="btn submit-btn w-100 mt-2">Record Payment</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}